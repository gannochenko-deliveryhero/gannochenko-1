{"componentChunkName":"component---src-components-blog-page-layout-blog-page-layout-tsx","path":"/blog/how-to-use-dynamodb-with-apollo-graphql-and-nodejs-serverless","result":{"data":{"mdx":{"id":"a0763678-10c1-5bee-9fe5-9d204188c565","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"How to use DynamoDB with Apollo GraphQL and NodeJS Serverless\",\n  \"description\": \"In the previous article we discussed how to set up Apollo with Serverless. Now we talk about how to put the DynamoDB database behind that Apollo client.\",\n  \"keywords\": \"dynamodb, aws, serverless, grahpql, apollo, nodejs\",\n  \"path\": \"/blog/how-to-use-dynamodb-with-apollo-graphql-and-nodejs-serverless\",\n  \"date\": \"2019-01-25T00:00:00.000Z\",\n  \"published\": true,\n  \"images\": [{\n    \"author\": \"Tobias Fischer\",\n    \"image\": \"/assets/blog/0_nZdxaCo7brmUEBfj.jpg\",\n    \"sourceText\": \"Unsplash\",\n    \"source\": \"https://unsplash.com/@tofi\",\n    \"is_cover\": 1,\n    \"galleryId\": 0\n  }]\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Serverless lambda is stateless. It means it does not share any data between two calls of the same function, so now we need to find out how to actually store the data.\"), mdx(\"p\", null, \"When it comes to AWS, we have multiple choices:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://aws.amazon.com/rds/aurora/\"\n  }), \"Aurora\"), \" \\u2014 a MySQL/PostgreSQL-compatible service,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://aws.amazon.com/documentdb/\"\n  }), \"DocumentDB\"), \" \\u2014 a MongoDB-compatible service,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://aws.amazon.com/dynamodb/\"\n  }), \"DynamoDB\"), \" \\u2014 a special kind of NO-SQL database,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://aws.amazon.com/elasticache/\"\n  }), \"ElastiCache\"), \" \\u2014 in-memory storage (based on Redis or Memcache),\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Any other data storage running on EC2.\")), mdx(\"p\", null, \"Today we will talk about DynamoDB. Facts you should know about DynamoDB before you proceed:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It does not support JOIN-s, it is a non-relational database.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It is a schema-less database, like MongoDB and unlike MySQL.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It supports storing of deeply-nested objects in DynamoDB table, like in MongoDB.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It is required to create tables explicitly with DynamoDB, like in MySQL and unlike in MongoDB.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It does not have a query optimizer. It means, that in order to optimize your quires you will have to tell DynamoDB which index you would like to use in every query, explicitly. This can be a crucial factor against DynamoDB if you are building, for example, a rich query constructor available for users.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The same problem exists when it is required to sort items in the result.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Also, the size of the result of searching cannot be more than 1mb. If there is more \\u2014 the database truncates the list of items and inform about this fact in the result.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It does not support storage of \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Date\"), \" objects, unlike in both MongoDB and MySQL (but you can always store a string representation of a date).\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It does not support integrity checks.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"It scales automatically, you don\\u2019t need to worry about provisioning: you just need to choose one of the available scaling strategies.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"You are allowed to create only one database on your account per a region, so if you want to create, let\\u2019s say, \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"stage\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"production\"), \" \\u201Cdatabases\\u201D, you will have to come up with a prefix system of some sort when naming your tables.\")), mdx(\"p\", null, \"Still sounds okay for your task? Then let\\u2019s go!\"), mdx(\"h2\", null, \"Step 1: Starter code {a}\"), mdx(\"p\", null, \"In the previous article, we have \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/blog/how-to-use-graphql-apollo-server-with-serverless\"\n  }), \"created a tiny lambda function and spun up Apollo GraphQL server\"), \" inside. I am going to re-use \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/gannochenko/poc_apollo-graphql-serverless\"\n  }), \"the repository we have made\"), \". Feel free to clone it or come up with something of your own, it does not have to be Serverless: an Express application will also do.\"), mdx(\"h2\", null, \"Step 2: Local installation {a}\"), mdx(\"p\", null, \"To avoid additional money expenses while developing the application, it is a good practice to have a DynamoDB server installed locally. I strongly encourage you to use Docker for this.\"), mdx(\"p\", null, \"So, open \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./compose.yml\"), \" and add there another service with a DynamoDB image:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-yaml\"\n  }), \"version: '3'\\n\\nservices:\\n    graphql.app:\\n        build:\\n            context: ./graphql.app/\\n            dockerfile: Dockerfile\\n        expose:\\n            - 3000\\n        ports:\\n            - 3000:3000\\n        volumes:\\n            - ./graphql.app/:/app\\n        environment:\\n            - DB_URL=http://db:8000\\n\\n    db:\\n        image: amazon/dynamodb-local\\n        entrypoint: java\\n        command: '-jar DynamoDBLocal.jar -sharedDb -dbPath /data'\\n        expose:\\n            - 8000\\n        ports:\\n            - 8000:8000\\n        volumes:\\n            - ./.db-files/:/data\\n\\n    db.gui:\\n        image: aaronshaf/dynamodb-admin\\n        expose:\\n            - 8001\\n        ports:\\n            - 8001:8001\\n        environment:\\n            - DYNAMO_ENDPOINT=http://db:8000\\n\")), mdx(\"p\", null, \"It is also required to create a\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./.db-files\"), \" folder in order to make the volume work.\"), mdx(\"p\", null, \"There are also other options, like a serverless plugin called \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.npmjs.com/package/serverless-dynamodb-local\"\n  }), \"serverless-dynamodb-local\"), \". It will require to install Java Runtime Environment though.\"), mdx(\"h2\", null, \"Step 3:\\xA0Tables {a}\"), mdx(\"p\", null, \"As an example, we will continue building our StarWars application based on \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://swapi.co/\"\n  }), \"swapi.co\"), \". We are going to weaponize our heroes because it is dangerous out there in a far-far galaxy where the star war happens.\"), mdx(\"p\", null, \"DynamoDB uses tables in order to store data. So, let's create one at\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/db/tables/weapon.js\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"export default {\\n    TableName: 'weapon',\\n    KeySchema: [\\n        {\\n            AttributeName: 'id',\\n            KeyType: 'HASH',\\n        },\\n    ],\\n    AttributeDefinitions: [\\n        {\\n            AttributeName: 'id',\\n            AttributeType: 'S',\\n        },\\n    ],\\n    ProvisionedThroughput: {\\n        ReadCapacityUnits: 5,\\n        WriteCapacityUnits: 5,\\n    },\\n};\\n\")), mdx(\"p\", null, \"DynamoDB is a schema-less database, but still, you need to define a shape of a so-called \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"\\\"partition key\\\"\"), \". Yes, DynamoDB uses partitioning to be fast and scalable. For each item, a key value should be unique and random with a good spread, in order to allocate keys between partitions as equally as possible. Most of the time, the partition key is also your primary key.\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Read/write capacity units\"), \" mean how many operations on a table you are going to have per second. On localhost, these values do not matter. In production, there are some advanced settings available to tune up the auto-scaling and provisioning, so these two values can adaptively vary according to the load level. The higher those values the more you pay.\"), mdx(\"p\", null, \"Configuring your provisioning strategy in the right way is important because if the database load breaches the limit defined by the capacity units, the requests will start failing, \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"they will not queue\"), \". Automatic upscaling may also take some time, so it is better to add a little bit more of resources.\"), mdx(\"p\", null, \"To be cool, we also create an index file for our table(s) in\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/db/tables/index.js\"), \" \\uD83E\\uDD18:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"import Weapon from './weapon';\\n\\nexport default [Weapon];\\n\")), mdx(\"h2\", null, \"Step 4: Database\\xA0class {a}\"), mdx(\"p\", null, \"Good news: we are not required to write API, it is already there: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.npmjs.com/package/aws-sdk\"\n  }), \"AWS SDK for JavaScript\"), \". Just install it:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"npm install aws-sdk crypto-random-string\\n\")), mdx(\"p\", null, \"Let's create a simple wrapper in order to manage our connection to the database.\"), mdx(\"p\", null, \"In the\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/db/index.js\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"import AWS from 'aws-sdk';\\n\\nimport tables from './tables';\\n\\nexport default class Database {\\n    async connect() {\\n        if (!this._connection) {\\n            let params = {};\\n            if (__DEV__) {\\n                params = {\\n                    endpoint: process.env.DB_URL,\\n                    region: 'local',\\n                    accessKeyId: 'local',\\n                    secretAccessKey: 'local',\\n                };\\n            } else {\\n                params = {\\n                    region: 'eu-central-1',\\n                    apiVersion: '2012-08-10',\\n                };\\n            }\\n\\n            this._connection = new AWS.DynamoDB(params);\\n\\n            if (__DEV__) {\\n                // will create tables through lambda only in development\\n                await this.createTables(tables);\\n            }\\n        }\\n\\n        return this._connection;\\n    }\\n\\n    async putItem(params) {\\n        return new Promise((resolve, reject) => {\\n            this._connection.putItem(params, (err, data) => {\\n                if (err) {\\n                    reject(err);\\n                } else {\\n                    resolve(data);\\n                }\\n            });\\n        });\\n    }\\n\\n    async getItem(params) {\\n        return new Promise((resolve, reject) => {\\n            this._connection.getItem(params, (err, data) => {\\n                if (err) {\\n                    reject(err);\\n                } else {\\n                    resolve(data);\\n                }\\n            });\\n        });\\n    }\\n\\n    async updateItem(params) {\\n        return new Promise((resolve, reject) => {\\n            this._connection.updateItem(params, (err, data) => {\\n                if (err) {\\n                    reject(err);\\n                } else {\\n                    resolve(data);\\n                }\\n            });\\n        });\\n    }\\n\\n    async scan(params = {}) {\\n        return new Promise((resolve, reject) => {\\n            this._connection.scan(params, (err, data) => {\\n                if (err) {\\n                    reject(err);\\n                } else {\\n                    resolve(data);\\n                }\\n            });\\n        });\\n    }\\n\\n    async deleteItem(params) {\\n        return new Promise((resolve, reject) => {\\n            this._connection.deleteItem(params, (err, data) => {\\n                if (err) {\\n                    reject(err);\\n                } else {\\n                    resolve(data);\\n                }\\n            });\\n        });\\n    }\\n\\n    async createTables(tables) {\\n        for (let k = 0; k < tables.length; k++) {\\n            const table = tables[k];\\n\\n            await new Promise((resolve, reject) => {\\n                this._connection.createTable(table, err => {\\n                    if (err) {\\n                        if (err.code !== 'ResourceInUseException') {\\n                            console.dir(err);\\n                            reject(err);\\n                        } else {\\n                            console.dir(`Table \\\"${table.TableName}\\\" exists`);\\n                            resolve();\\n                        }\\n                    } else {\\n                        console.dir(`Created table \\\"${table.TableName}\\\"`);\\n                        resolve();\\n                    }\\n                });\\n            });\\n        }\\n    }\\n}\\n\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Important\"), \": make sure that \\\"region\\\" for production is the same as in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"serverless.yml\"), \" file.\"), mdx(\"p\", null, \"I have decided to wrap database methods with promises, in order to make the consumer code slightly better. I hope you don't mind.\"), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"__DEV__\"), \" constant is defined using Webpack DefinePlugin in\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/webpack.config.js\"), \" like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"...\\nconst webpack = require('webpack');\\n\\nmodule.exports = {\\n    ...\\n    plugins: [\\n        new webpack.DefinePlugin({\\n            __DEV__: slsw.lib.webpack.isLocal,\\n        }),\\n    ]\\n};\\n\")), mdx(\"h2\", null, \"Step 5: Exposition through\\xA0GraphQL {a}\"), mdx(\"p\", null, \"In order to expose our database to the outer world, we will connect it to the GraphQL server.\"), mdx(\"p\", null, \"So, let's create all necessary files.\"), mdx(\"h2\", null, \"Types {a}\"), mdx(\"p\", null, \"For the entity itself in\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/types/weapon.graphql\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"enum WeaponType {\\n    LIGHTSABER\\n    BLASTER\\n}\\n\\ntype WeaponParameters {\\n    name: String!\\n    value: String!\\n}\\n\\ninput WeaponParametersInput {\\n    name: String!\\n    value: String!\\n}\\n\\ntype Weapon {\\n    id: String!\\n    name: String!\\n    type: WeaponType!\\n    damage: Int\\n    parameters: [WeaponParameters]\\n    characters: [Character]\\n}\\n\\ninput WeaponInput {\\n    id: String\\n    name: String!\\n    type: WeaponType!\\n    damage: Int\\n    parameters: [WeaponParametersInput]\\n}\\n\\ntype Mutation {\\n    putWeapon(data: WeaponInput!): Result\\n    deleteWeapon(id: String!): Result\\n}\\n\")), mdx(\"p\", null, \"And also a tiny type for the result in\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/types/util.graphql\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"type Result {\\n    error: String\\n}\\n\")), mdx(\"p\", null, \"Then we update the\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/types/index.js\"), \" file in order to plug the types in:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"import { mergeTypes } from 'merge-graphql-schemas';\\n\\nimport util from './util.graphql';\\nimport movie from './movie.graphql';\\nimport character from './character.graphql';\\nimport weapon from './weapon.graphql';\\n\\nexport default mergeTypes([util, movie, character, weapon], { all: true });\\n\")), mdx(\"p\", null, \"We also patch our characters types file in order to create a mutation.\"), mdx(\"p\", null, \"So, in\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/types/character.graphql\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"type Character {\\n    id: String!\\n    fullName: String!\\n    movies: [Movie]!\\n    weapon: [Weapon]\\n}\\n\\ntype Mutation {\\n    equipWeapon(characterId: String!, weaponId: String!): Result\\n}\\n\")), mdx(\"h2\", null, \"Resolvers {a}\"), mdx(\"p\", null, \"The same goes for the resolvers. We create a new resolver file for the weapon entity:\"), mdx(\"p\", null, \"In\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/resolvers/weapon.js\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"export default {\\n    Mutation: {\\n        putWeapon: async (source, args, { dataSources }, state) => {\\n            const { data } = args;\\n\\n            let result = {};\\n            try {\\n                await dataSources.weaponSource.put(data);\\n            } catch (e) {\\n                console.error(e);\\n                result.error = 'Internal error';\\n            }\\n\\n            return result;\\n        },\\n        deleteWeapon: async (source, args, { dataSources }, state) => {\\n            const { id } = args;\\n\\n            let result = {};\\n            try {\\n                await dataSources.weaponSource.delete(id);\\n            } catch (e) {\\n                console.error(e);\\n                result.error = 'Internal error';\\n            }\\n\\n            return result;\\n        },\\n    },\\n};\\n\")), mdx(\"p\", null, \"And we patch the characters resolver.\\xA0\\nIn\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/resolvers/character.js\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"export default {\\n    Character: {\\n        movies: async (source, args, { dataSources }, state) => {\\n            return dataSources.movieSource(source.movies);\\n        },\\n        weapon: async (source, args, { dataSources }, state) => {\\n            return await dataSources.weaponSource.getForCharacter(source.id);\\n        },\\n    },\\n    Mutation: {\\n        equipWeapon: async (source, args, { dataSources }, state) => {\\n            const { characterId, weaponId } = args;\\n            const { weaponSource } = dataSources;\\n\\n            let result = {};\\n            try {\\n                result = weaponSource.giveToCharacter(weaponId, characterId);\\n            } catch (e) {\\n                console.error(e);\\n                result.error = 'Internal error';\\n            }\\n\\n            return result;\\n        },\\n    },\\n};\\n\")), mdx(\"p\", null, \"Don't forget to include all the resolvers in\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/resolvers/index.js\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"import { mergeResolvers } from 'merge-graphql-schemas';\\nimport movieResolver from './movie';\\nimport characterResolver from './character';\\nimport weaponResolver from './weapon';\\n\\nconst resolvers = [movieResolver, characterResolver, weaponResolver];\\n\\nexport default mergeResolvers(resolvers);\\n\")), mdx(\"p\", null, \"Phewww\\u2026 that was a lot. But the most annoying (I mean interesting) part is ahead: the data source.\"), mdx(\"h2\", null, \"Step 6: Database operations and the data\\xA0source {a}\"), mdx(\"p\", null, \"We are going to create a data source file for our weapon entity:\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/dataSources/weapon.js\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"import Database from '../../db';\\nimport stringGen from 'crypto-random-string';\\n\\nexport default class WeaponSource {\\n    // our methods go here, we are going to discuss them below\\n\\n    async getDatabase() {\\n        if (!this._db) {\\n            this._db = new Database();\\n            await this._db.connect();\\n        }\\n\\n        return this._db;\\n    }\\n}\\n\")), mdx(\"p\", null, \"Before discussing the methods, don't forget to initialize the data source in our handler\\xA0\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/index.js\"), \":\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"import { ApolloServer } from 'apollo-server-lambda';\\nimport resolvers from './graphql/resolvers';\\nimport typeDefs from './graphql/types';\\nimport characterSource from './graphql/dataSources/character';\\nimport movieSource from './graphql/dataSources/movie';\\nimport WeaponSource from './graphql/dataSources/weapon';\\n\\n// creating the server\\nconst server = new ApolloServer({\\n    // passing types and resolvers to the server\\n    typeDefs,\\n    resolvers,\\n\\n    // initial context state, will be available in resolvers\\n    context: () => ({}),\\n\\n    // an object that goes to the \\\"context\\\" argument\\n    // when executing resolvers\\n    dataSources: () => {\\n        return {\\n            characterSource,\\n            movieSource,\\n            weaponSource: new WeaponSource(),\\n        };\\n    },\\n});\\n\\nconst handler = (event, context, callback) => {\\n    const handler = server.createHandler();\\n\\n    // tell AWS lambda we do not want to wait for NodeJS event loop\\n    // to be empty in order to send the response\\n    context.callbackWaitsForEmptyEventLoop = false;\\n\\n    // process the request\\n    return handler(event, context, callback);\\n};\\n\\nexport default handler;\\n\")), mdx(\"h3\", null, \"How to add/replace an\\xA0item {a}\"), mdx(\"p\", null, \"We are going to use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"putItem()\"), \". The method is an \\\"insert-replace\\\" operation, and you need to specify the primary key value in advance.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"async put(data) {\\n\\n    const parameters = data.parameters || [];\\n    const allowedParams = ['color'];\\n\\n    const item = {\\n        name: {\\n            S: data.name.toString(),\\n        },\\n        type: {\\n            S: data.type.toString(),\\n        },\\n        damage: {\\n            N: data.damage ? data.damage.toString() : '0',\\n        },\\n        parameters: {\\n            // always check what you save to the database, against a white list\\n            M: parameters.filter(x => allowedParams.indexOf(x.name) >= 0).reduce((result, item) => {\\n                result[item.name] = {\\n                    S: item.value ? item.value.toString() : '',\\n                };\\n                return result;\\n            }, {})\\n        }\\n    };\\n\\n    if (data.id) {\\n        item.id = {S: data.id.toString()};\\n    } else {\\n        // as we mentioned before, we need to specify a new key explicitly\\n        item.id = {S: stringGen(12)};\\n    }\\n\\n    const db = await this.getDatabase();\\n    await db.putItem({\\n        TableName: 'weapon',\\n        Item: item,\\n    });\\n}\\n\")), mdx(\"p\", null, \"As you may have already noticed, the syntax is quite complex. You should not only specify a value of an attribute, but also its type as a key of an extra object. This looks even weirder if you came here from MongoDB, where you need just pass a data object as it is and that is it.\"), mdx(\"p\", null, \"I bet, the guys from Amazon felt like this too, so they made another class called \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html\"\n  }), \"DocumentClient\"), \". It makes things a little bit fancier because the class tries to map JavaScript data types into DynamoDB types automatically. Feel free to explore it on your own.\"), mdx(\"p\", null, \"Meanwhile, the most useful types are:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"S\\u200A-\\u200Astring \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"{S: \\\"Hello\\\"}\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"N\\u200A-\\u200Anumber \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"{N: \\\"3.14\\\"}\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"L\\u200A-\\u200Aa list of values of a different type \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"{L: [{S: \\\"I am a string\\\"}, {N: \\\"9.999\\\"}]}\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"M\\u200A-\\u200Aa sub-object \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"{M: {oneKey: {S: \\\"Agent\\\"}, anotherKey: {N: \\\"0.07\\\"}}}\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"BOOL\\u200A-\\u200Aa boolean (so obvious) \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"{BOOL: true}\"))), mdx(\"p\", null, \"There are other specific types, see \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB.html#putItem-property\"\n  }), \"the documentation\"), \". Note, that\\xA0:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"while put()-ting an item, you may specify any structure you like, and you don't need to describe a schema,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"the actual attribute values should be always converted to a string.\")), mdx(\"h3\", null, \"How to delete an\\xA0item {a}\"), mdx(\"p\", null, \"The delete operation is quite straight-forward, you just need to specify your partition key value:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"async delete(id) {\\n    const db = await this.getDatabase();\\n    await db.deleteItem({\\n        TableName: 'weapon',\\n        Key: {\\n            id: {\\n                S: id.toString(),\\n            },\\n        },\\n    });\\n}\\n\")), mdx(\"h3\", null, \"How to get an item by\\xA0id {a}\"), mdx(\"p\", null, \"This operation works pretty the same as the delete operation:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"async get(id) {\\n    const db = await this.getDatabase();\\n    return db.getItem({\\n        TableName: 'weapon',\\n        Key: {\\n            id: {\\n                S: id.toString(),\\n            },\\n        },\\n    });\\n}\\n\")), mdx(\"h3\", null, \"How to update an\\xA0item {a}\"), mdx(\"p\", null, \"When it comes to updating and searching, things look like kind of SQL\\xA0:) We need to specify an update expression and fill up placeholders. I guess, by using the placeholders DynamoDB allows us to prevent injections automatically (well, at least I have tried to make an injection and failed:) ).\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"async giveToCharacter(id, characterId) {\\n    const result = {};\\n    const res = await this.get(id);\\n    if (res && res.Item) {\\n        const characters = res.Item.characters || {\\n            L: [],\\n        };\\n        characters.L.push({\\n            S: characterId,\\n        });\\n\\n        const db = await this.getDatabase();\\n        await db.updateItem({\\n            TableName: 'weapon',\\n            Key: {\\n                id: {\\n                    S: id.toString(),\\n                },\\n            },\\n            ExpressionAttributeNames: {\\n                '#CHARACTERS': 'characters',\\n            },\\n            ExpressionAttributeValues: {\\n                ':c': characters,\\n            },\\n            UpdateExpression: 'SET #CHARACTERS = :c'\\n        });\\n    } else {\\n        result.error = 'Item not found';\\n    }\\n\\n    return result;\\n}\\n\")), mdx(\"h3\", null, \"How to search for an\\xA0item {a}\"), mdx(\"p\", null, \"For searching there are two methods: scan() and query(). Let's try the first one. The same expression and placeholders work here.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"async getForCharacter(id) {\\n    const db = await this.getDatabase();\\n    const result = await db.scan({\\n        TableName: 'weapon',\\n        ExpressionAttributeValues: {\\n            ':cId': {\\n                S: id,\\n            },\\n        },\\n        FilterExpression: 'contains(characters, :cId)',\\n    });\\n\\n    if (result && result.Items) {\\n        // need to \\\"decode\\\" the items, i know this is annoying\\n        return result.Items.map((item) => {\\n\\n            const p = item.parameters ? item.parameters.M : {};\\n            const parameters = [];\\n            Object.keys(p).forEach((k) => {\\n                parameters.push({\\n                    name: k,\\n                    value: p[k].S,\\n                });\\n            });\\n\\n            return {\\n                name: item.name.S,\\n                damage: item.damage.N,\\n                id: item.id.S,\\n                type: item.type.S,\\n                parameters,\\n            };\\n        });\\n    }\\n\\n    return [];\\n}\\n\")), mdx(\"p\", null, \"Whoooa, that was aaaaaalot of code. Now it is time to have some fun.\"), mdx(\"h2\", null, \"Step 7: Playing\\xA0around {a}\"), mdx(\"p\", null, \"Let's start the application:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"docker-compose -f compose.yml up\\n\")), mdx(\"p\", null, \"and go to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://localhost:3000/graphql\"\n  }), \"http://localhost:3000/graphql\"), \".\"), mdx(\"p\", null, \"Create a red lightsaber.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"mutation {\\n    putWeapon(\\n        data: {\\n            name: \\\"The sword of DOOM\\\"\\n            type: LIGHTSABER\\n            damage: 1000\\n            parameters: [{ name: \\\"color\\\", value: \\\"red\\\" }]\\n        }\\n    ) {\\n        error\\n    }\\n}\\n\")), mdx(\"p\", null, \"In the database manager \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://localhost:8001/tables/weapon\"\n  }), \"http://localhost:8001/tables/weapon\"), \" we can see it now:\"), mdx(Effect, {\n    mdxType: \"Effect\"\n  }, mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"702px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/0233c5e86eea80e3719ee2f4b9daf750/eafa3/1_oCe9DRfBui3QWuQKb11cOg.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"26.640926640926644%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAFABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3wQH/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABPyF//9oADAMBAAIAAwAAABADz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABoQAAICAwAAAAAAAAAAAAAAAAAhAVERQaH/2gAIAQEAAT8QdjvhG8s//9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Lightsaber\",\n    \"title\": \"Lightsaber\",\n    \"src\": \"/static/0233c5e86eea80e3719ee2f4b9daf750/eafa3/1_oCe9DRfBui3QWuQKb11cOg.jpg\",\n    \"srcSet\": [\"/static/0233c5e86eea80e3719ee2f4b9daf750/8356d/1_oCe9DRfBui3QWuQKb11cOg.jpg 259w\", \"/static/0233c5e86eea80e3719ee2f4b9daf750/bc760/1_oCe9DRfBui3QWuQKb11cOg.jpg 518w\", \"/static/0233c5e86eea80e3719ee2f4b9daf750/eafa3/1_oCe9DRfBui3QWuQKb11cOg.jpg 702w\"],\n    \"sizes\": \"(max-width: 702px) 100vw, 702px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"))), mdx(\"p\", null, \"Now give the sword to Darth Vader.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"mutation {\\n    equipWeapon(weaponId: \\\"9085719d934c\\\", characterId: \\\"1\\\") {\\n        error\\n    }\\n}\\n\")), mdx(Effect, {\n    mdxType: \"Effect\"\n  }, mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"600px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/dbdf34b6fe5a9540e0d794159121b997/b4294/oie_2321424G6pJ20e0.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"74.90347490347492%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAMEAv/EABQBAQAAAAAAAAAAAAAAAAAAAAL/2gAMAwEAAhADEAAAAYq0YKqGhf8A/8QAGRAAAwEBAQAAAAAAAAAAAAAAAQIDABMS/9oACAEBAAEFApMVwAsnE4jkZ+qNOZUf/8QAFREBAQAAAAAAAAAAAAAAAAAAABH/2gAIAQMBAT8BR//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAECAQE/AVf/xAAdEAACAQQDAAAAAAAAAAAAAAAAARECEiIxMlFh/9oACAEBAAY/Aqo6FNWRy14O3RY2Q2f/xAAaEAEAAwEBAQAAAAAAAAAAAAABABFBITGB/9oACAEBAAE/IQn9JyY0JONUfGowsurLAJZd1FafcZ//2gAMAwEAAgADAAAAEGQP/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARYf/aAAgBAwEBPxAEcji//8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERIXH/2gAIAQIBAT8QbqUaP//EABwQAQACAwADAAAAAAAAAAAAAAERIQAxYUFRcf/aAAgBAQABPxA9Ykj6X47gzFG5WKk1zBwRDi5Zk9EJLFbgo7OMXrG1+CaxIJWilmf/2Q==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Darth Vader is always angry\",\n    \"title\": \"Darth Vader is always angry\",\n    \"src\": \"/static/dbdf34b6fe5a9540e0d794159121b997/b4294/oie_2321424G6pJ20e0.jpg\",\n    \"srcSet\": [\"/static/dbdf34b6fe5a9540e0d794159121b997/8356d/oie_2321424G6pJ20e0.jpg 259w\", \"/static/dbdf34b6fe5a9540e0d794159121b997/bc760/oie_2321424G6pJ20e0.jpg 518w\", \"/static/dbdf34b6fe5a9540e0d794159121b997/b4294/oie_2321424G6pJ20e0.jpg 600w\"],\n    \"sizes\": \"(max-width: 600px) 100vw, 600px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"))), mdx(\"p\", null, \"Now if we call for the entire structure, we can write the query like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"query {\\n    movie(id: \\\"1\\\") {\\n        title\\n        characters {\\n            fullName\\n            weapon {\\n                name\\n                type\\n                damage\\n                parameters {\\n                    name\\n                    value\\n                }\\n            }\\n        }\\n    }\\n}\\n\")), mdx(\"p\", null, \"Darth Vader now has a weapon.\"), mdx(Effect, {\n    mdxType: \"Effect\"\n  }, mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"740px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/75dcb9f07e3a1d9f73e9d1872b59fdd7/07f3a/1_jhUISmN07DMjgph3w1RPWg.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"59.45945945945946%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAC/9oADAMBAAIQAxAAAAHj3ndSB//EABcQAAMBAAAAAAAAAAAAAAAAAAABESD/2gAIAQEAAQUCLXj/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAXEAEAAwAAAAAAAAAAAAAAAAABACAx/9oACAEBAAE/IYpF1r//2gAMAwEAAgADAAAAECAv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQIBAT8QJ//EABoQAQACAwEAAAAAAAAAAAAAAAEAERAhMUH/2gAIAQEAAT8QHr6bIgdpa1W4pfMHIz//2Q==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Darth Vader has a weapon\",\n    \"title\": \"Darth Vader has a weapon\",\n    \"src\": \"/static/75dcb9f07e3a1d9f73e9d1872b59fdd7/07f3a/1_jhUISmN07DMjgph3w1RPWg.jpg\",\n    \"srcSet\": [\"/static/75dcb9f07e3a1d9f73e9d1872b59fdd7/8356d/1_jhUISmN07DMjgph3w1RPWg.jpg 259w\", \"/static/75dcb9f07e3a1d9f73e9d1872b59fdd7/bc760/1_jhUISmN07DMjgph3w1RPWg.jpg 518w\", \"/static/75dcb9f07e3a1d9f73e9d1872b59fdd7/07f3a/1_jhUISmN07DMjgph3w1RPWg.jpg 740w\"],\n    \"sizes\": \"(max-width: 740px) 100vw, 740px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \"))), mdx(\"p\", null, \"But, naaaah, it is too dangerous to keep this weapon in wrong hands, it is better to have the sword destroyed once and for all:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"mutation {\\n    deleteWeapon(id: \\\"9085719d934c\\\") {\\n        error\\n    }\\n}\\n\")), mdx(\"h2\", null, \"Step 8: Deployment {a}\"), mdx(\"p\", null, \"The deployment is done as usual with serverless.\"), mdx(\"p\", null, \"Authenticate like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"npx serverless config credentials --provider aws --key #ACCESS_KEY_ID# --secret #SECRET_ACCESS_KEY#\\n\")), mdx(\"p\", null, \"Then deploy like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"npx serverless deploy\\n\")), mdx(\"p\", null, \"But with DynamoDB on-board, we need to make two additional things.\"), mdx(\"h3\", null, \"Tables {a}\"), mdx(\"p\", null, \"Yes, again, but now in production. A table creation operation is quite heavy by itself, and keep in mind that we pay money for each millisecond while we execute the code inside our lambdas. Therefore, it is better to have our lambdas as fast as possible and create tables in advance.\"), mdx(\"p\", null, \"We have several options here to create our table:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"in the AWS console opened in the browser,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"with an \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/cli/latest/reference/dynamodb/create-table.html\"\n  }), \"AWS command line tool\"), \",\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"with a Cloud Formation script, \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://s3-us-west-2.amazonaws.com/cloudformation-templates-us-west-2/DynamoDB_Table.template\"\n  }), \"like this one\"), \".\")), mdx(\"p\", null, \"For now, let\\u2019s choose the first option: go to the DynamoDB in the AWS console (don\\u2019t forget to choose a proper region!) and create a new table.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"559px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/dc1076dccb265ed9f722fd4df7972767/db7b4/1_jE8U5S_cdjAFM6hENx6n1A.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"73.35907335907336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB27QUf//EABcQAQEBAQAAAAAAAAAAAAAAAAAhEBH/2gAIAQEAAQUCVxd//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGxAAAwADAQEAAAAAAAAAAAAAAAERITFBUWH/2gAIAQEAAT8hdT2LDaK9L0sCd4T4j//aAAwDAQACAAMAAAAQw8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAeEAEAAgEEAwAAAAAAAAAAAAABABExIUFxgVFh0f/aAAgBAQABPxAsEecspGDhYblu37EB1OVR9Jc9sEYLuf/Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Create DynamoDB table\",\n    \"title\": \"Create DynamoDB table\",\n    \"src\": \"/static/dc1076dccb265ed9f722fd4df7972767/db7b4/1_jE8U5S_cdjAFM6hENx6n1A.jpg\",\n    \"srcSet\": [\"/static/dc1076dccb265ed9f722fd4df7972767/8356d/1_jE8U5S_cdjAFM6hENx6n1A.jpg 259w\", \"/static/dc1076dccb265ed9f722fd4df7972767/bc760/1_jE8U5S_cdjAFM6hENx6n1A.jpg 518w\", \"/static/dc1076dccb265ed9f722fd4df7972767/db7b4/1_jE8U5S_cdjAFM6hENx6n1A.jpg 559w\"],\n    \"sizes\": \"(max-width: 559px) 100vw, 559px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"h3\", null, \"Give permissions {a}\"), mdx(\"p\", null, \"By default, any service does not have access to the other services, the policy is initially set to \\u201Cdeny\\u201D. We need to allow our lambda to talk to the database.\"), mdx(\"p\", null, \"Go to CloudFormation \\u2192 Stacks\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"582px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/1934037f984157b89a268ae524593594/14007/1_3ds_iJVfEjBF4DYkXOzbdQ.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"44.78764478764479%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe5UimD/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAYEAADAQEAAAAAAAAAAAAAAAAAARARIf/aAAgBAQABPyHOzBjn/9oADAMBAAIAAwAAABCAD//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABoQAAIDAQEAAAAAAAAAAAAAAAABESExQVH/2gAIAQEAAT8QULdtDSUTRDw2jaFiP//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"CloudFormation stacks\",\n    \"title\": \"CloudFormation stacks\",\n    \"src\": \"/static/1934037f984157b89a268ae524593594/14007/1_3ds_iJVfEjBF4DYkXOzbdQ.jpg\",\n    \"srcSet\": [\"/static/1934037f984157b89a268ae524593594/8356d/1_3ds_iJVfEjBF4DYkXOzbdQ.jpg 259w\", \"/static/1934037f984157b89a268ae524593594/bc760/1_3ds_iJVfEjBF4DYkXOzbdQ.jpg 518w\", \"/static/1934037f984157b89a268ae524593594/14007/1_3ds_iJVfEjBF4DYkXOzbdQ.jpg 582w\"],\n    \"sizes\": \"(max-width: 582px) 100vw, 582px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Click on the stack name, go to the \\u201CResources\\u201D tab and find our lambda permission role.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"627px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/b9410dcc687bdf25e245367d06ada231/362f5/1_vaBlZiiHl7MNLi-F3Z6NCg.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"62.54826254826254%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHaoSMoP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABkQAQEAAwEAAAAAAAAAAAAAAAEAESFRMf/aAAgBAQABPyEF8bDy3yIcxsv/2gAMAwEAAgADAAAAEBcf/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAAIDAQEAAAAAAAAAAAAAAQARMVHxIXH/2gAIAQEAAT8QAy/Kh0SukXiatuVkrBmAB3P/2Q==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"CloudFormation stacks details\",\n    \"title\": \"CloudFormation stacks details\",\n    \"src\": \"/static/b9410dcc687bdf25e245367d06ada231/362f5/1_vaBlZiiHl7MNLi-F3Z6NCg.jpg\",\n    \"srcSet\": [\"/static/b9410dcc687bdf25e245367d06ada231/8356d/1_vaBlZiiHl7MNLi-F3Z6NCg.jpg 259w\", \"/static/b9410dcc687bdf25e245367d06ada231/bc760/1_vaBlZiiHl7MNLi-F3Z6NCg.jpg 518w\", \"/static/b9410dcc687bdf25e245367d06ada231/362f5/1_vaBlZiiHl7MNLi-F3Z6NCg.jpg 627w\"],\n    \"sizes\": \"(max-width: 627px) 100vw, 627px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Click on the \\u201CPhysical ID\\u201D.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"667px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/0aab950171d346b342602202f996ea75/e20b3/1_Lz11z2pfENjMFkugNoqDAw.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"53.66795366795367%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAdq1Qig//8QAFhAAAwAAAAAAAAAAAAAAAAAAESAh/9oACAEBAAEFAqV//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFRABAQAAAAAAAAAAAAAAAAAAICH/2gAIAQEABj8Cq//EAB0QAAICAQUAAAAAAAAAAAAAAAABIUEQMVFhkcH/2gAIAQEAAT8h1acEbPsUUP0Sx//aAAwDAQACAAMAAAAQM8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEBAQEBAQEAAAAAAAAAAAABEQBRITGR/9oACAEBAAE/EIAjn1cHRiBBfuBbCvGIPh7oc3//2Q==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Permission policies\",\n    \"title\": \"Permission policies\",\n    \"src\": \"/static/0aab950171d346b342602202f996ea75/e20b3/1_Lz11z2pfENjMFkugNoqDAw.jpg\",\n    \"srcSet\": [\"/static/0aab950171d346b342602202f996ea75/8356d/1_Lz11z2pfENjMFkugNoqDAw.jpg 259w\", \"/static/0aab950171d346b342602202f996ea75/bc760/1_Lz11z2pfENjMFkugNoqDAw.jpg 518w\", \"/static/0aab950171d346b342602202f996ea75/e20b3/1_Lz11z2pfENjMFkugNoqDAw.jpg 667w\"],\n    \"sizes\": \"(max-width: 667px) 100vw, 667px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"Now, for the real-real production, we should have pressed \\u201CEdit policy\\u201D and add as granular security permission as possible, by narrowing it to \\u201Callow several operations on weapons table from a certain account in a certain region\\u201D. But this goes really beyond the scope of the article, so we are going just click on \\u201CAttach policies\\u201D and add a pre-existed \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AmazonDynamoDBFullAccess\"), \" policy.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"884px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/a895e24214419915cd8c33f8dda9701e/e3528/1_EMe7ZYGxIjuqmHeg4PO4_g.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"37.06563706563707%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAduwQD//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAZEAADAAMAAAAAAAAAAAAAAAAAAREhQVH/2gAIAQEAAT8hrTkpl6RXxH//2gAMAwEAAgADAAAAEAAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGBABAQEBAQAAAAAAAAAAAAAAAREAIUH/2gAIAQEAAT8QE109uIUA0qQ3/9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Create policy\",\n    \"title\": \"Create policy\",\n    \"src\": \"/static/a895e24214419915cd8c33f8dda9701e/e3528/1_EMe7ZYGxIjuqmHeg4PO4_g.jpg\",\n    \"srcSet\": [\"/static/a895e24214419915cd8c33f8dda9701e/8356d/1_EMe7ZYGxIjuqmHeg4PO4_g.jpg 259w\", \"/static/a895e24214419915cd8c33f8dda9701e/bc760/1_EMe7ZYGxIjuqmHeg4PO4_g.jpg 518w\", \"/static/a895e24214419915cd8c33f8dda9701e/e3528/1_EMe7ZYGxIjuqmHeg4PO4_g.jpg 884w\"],\n    \"sizes\": \"(max-width: 884px) 100vw, 884px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"So, click on the checkbox and then on \\u201CAttach policy\\u201D button.\"), mdx(\"h2\", null, \"Conclusion {a}\"), mdx(\"p\", null, \"Wow, that was a long article. Now we have learned how to run Apollo GraphQL server inside a lambda and use DynamoDB as a data storage.\"), mdx(\"h2\", null, \"Troubleshooting {a}\"), mdx(\"h3\", null, \"Task timed out after N seconds {a}\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Check if your code is valid, so there is no \\u201Cpending\\u201D abandoned promise somewhere around. Otherwise, it is probably not a problem of your lambda.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Make sure that your DynamoDB region is right (so you have not put \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"eu-north\"), \" instead of \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"eu-north-1\"), \" by mistake).\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If nothing helped, try to increase your Read/Write capacity a little bit, or even switch to the \\u201Con-demand\\u201D strategy (don\\u2019t forget about your billing!).\")), mdx(\"h3\", null, \"The specified bucket does not exist {a}\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"go to AWS console, enter CloudFormation and delete the deployment,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"OR rename your service in \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"serverless.yml\"), \".\")), mdx(\"h3\", null, \"Requested resource not found {a}\"), mdx(\"p\", null, \"Make sure that your DynamoDB table is created in the right region (we have used \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"eu-central-1\"), \" above) and it is not in the \\u201CCreating\\u201D state.\"), mdx(\"p\", null, \"Thanks for reading! I hope this article was helpful for you :)\"), mdx(\"h2\", null, \"Extras {a}\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"here is the \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/gannochenko/poc_dynamo-db\"\n  }), \"proof-of-concept repository\"), \" made for the article,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"read the official documentation on \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/SQLtoNoSQL.Indexes.html\"\n  }), \"how to make indexes\"), \",\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"consider reading the \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/best-practices.html\"\n  }), \"official best practices with DynamoDB\"), \",\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"a new \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://aws.amazon.com/blogs/aws/amazon-dynamodb-on-demand-no-capacity-planning-and-pay-per-request-pricing/\"\n  }), \"\\u201Con demand\\u201D mode of provisioning\"), \",\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"full \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB.html\"\n  }), \"documentation on aws-sdk\"), \",\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"always \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://aws.amazon.com/dynamodb/pricing/\"\n  }), \"mind the prices\"), \".\")), mdx(\"p\", null, \"Happy DynamoDB usage experience!\"), mdx(\"p\", null, \"\\u2190 Previous article: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/blog/how-to-use-graphql-apollo-server-with-serverless\"\n  }), \"How to use Apollo GraphQL server with Serverless offline and in production\")));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"How to use DynamoDB with Apollo GraphQL and NodeJS Serverless","date":"2019-01-25T00:00:00.000Z","keywords":"dynamodb, aws, serverless, grahpql, apollo, nodejs","description":"In the previous article we discussed how to set up Apollo with Serverless. Now we talk about how to put the DynamoDB database behind that Apollo client.","published":true,"images":[{"image":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='300'%20viewBox='0%200%20400%20300'%20preserveAspectRatio='none'%3e%3cpath%20d='M23%201c2%200%203%203%201%203l-1%201-11%201H0v54h5c4%200%205%200%206%202l5%201h3c-1%201%200%202%202%201l1%201h-3l-2-1v1c2%202%202%202%201%203-2%201-3%203-1%203l2%201c0%202%201%202%203%202%202-1%203%200%203%201%201%202%201%202%203%202%201-1%202%200%203%201h-2c-3%200-3%200-3%202l-2%202c-2%200-3%201-3%202s0%202-2%202l-2%201c0%203%200%203-2%203s-3%203-2%203v1c-2%200-4-2-3-4l-1-3-1-6c1-4-1-6-6-5-3%201-3%203%201%203h2l-2%201-1%201v1l-2%201c0%202%202%204%203%204h1l-2%201c-2%200-3%205%200%208v3l-1-2a940%20940%200%20003%2095h5l2-3v-1c3%201%205%200%204-2l1-1%202%206c1%206%201%206-1%208s-2%202%203%203l7%201c2-1%203%200%200%202-1%201-1%201%201%201l3-1h1c0%202%205%206%207%206%201-1%203%200%204%201l3%201h-6c2%202%200%203-2%202l-3-1c-2%201-3%203-1%203v1c-1%201-2%200-2-1h-1l-3%204v-1l-1-2c-2-1-3-1-2%201h-1c-1-1-1-1-1%201h-1c-1-1-1-1-1%201v2l-1-2-1-2v4l-1-2c-1-2-1-2-1%201%200%202%200%202-1%201-1-2-1-2-1%200s0%202-1%201c-1-2-1-2-1%200s0%202-1%201l-1-2v2h-1c-1-1-1-1-1%201H7l-4-2-3-4v80h120l-3-2-3-3%202-3%204-3-1-1-2-2v-3c-2-1%203-3%205-2l1-1c-1-1%203-3%204-2%202%202%203%201%203-3-1-4%205-11%207-9s3%201%203-1a1131%201131%200%200047-41l12%205%2012%205c8%203%2010%204%2010%207%201%202%201%202%201%200l2-2v3l1-1%202-1v3h1c0-2%200-2%202-2l2%201%201%201c-1%201%200%201%201%201l2%202h-2c-1%203-1%203%201%202%204-1%209-1%209%201l1%201v2l1%204c0%202-1%202-3%202-2-1-3%200-6%202l-4%203h-6c-2%201-5%202-6%201l-2%201v1c-2%200-2-2%201-4l3-7c0-5%201-6%203-5%202%200%202%200%202-2l-1-3-1%202c1%201%201%202-1%201l-2-2c-1-2-1-1-2%202l-2%204-1%204v4l-9%201-13%202c-2%200-11%209-8%209l-1%201v2c4%203%203%205-1%203s-5-1-2%202l2%203h-3c-2%200-3-1-3-2%200-2%200-2-2%200s-3%203-3%208%200%205%202%206c3%200%203%200%202%203l-2%202h66l-4-3-9-7a118%20118%200%2000-14-12l8-2c7%200%208%200%2015%202l7%203%2017-2h22l2%201c1-1%2010%203%2010%204l3%201c3%200%206%202%206%203l-3%207-2%205h3l3-1h1l46%201h47v-41c0-22-1-28-1-13v27l-3-2-2-3-2-4c-5-5-7-17-5-22%201-3-1-12-3-12l-1-2%203-9%203-9%203-4c0-2%202-3%204-3%202-1%203-2%203-4%200-4-3-7-6-5-2%201-2%201-2-3%202-7-1-5-3%204-2%208-4%209-3%203%201-4%201-4-2-5l-4-2h-2l-2-1-3-1h-15l-13-2-3-1-3-1-2-2-8-3-10-4-2-1-2-1c-4%200-11-3-11-5%200-1%200-2%201-1l1-1h2l6%201c23%205%2024%205%2024%201l1-9%201-6a272%20272%200%2000-36-7c0-2%201-2%205-2l5-1c0-2%203-3%203-1l-2%202c-2%201-2%201%200%201h3c1%201%202%200%203-2h2l2%201v2c1%201%201%201%201-1v-2l1%202%201%201%202-2%201%201v1l2%202%202%201%203-1%202-2c1%200%201%202-1%203-1%201-1%201%201%201l2%202%201%201v-7h2l-5-2-4-1%204%201h5l1-4%201-6%201-3-12-2-19-2-7-2%207-3c7-3%208-3%2014-2s10%203%2010%205c-1%201%201%201%205%202%204%202%206%202%206%204v1l-1%204c0%203%200%203%201%201%201-3%206-4%207-1%201%201%201%201%204-1l3-2h1a326%20326%200%200122-1l2-1%201-1%204-1h4v11l-3-1a790%20790%200%2001-18-2c2%201%204%205%202%205l-1%202-2%202c-3%200-5%204-2%204v1c-2%200-2%201-2%203s1%203%204%203c2%200%203%200%202-1v-2c1-1%201-1%202%201v2l6%202c11%202%2012%202%2012%204s-1%202-14-1c-19-4-17-4-19%205l-2%209%202%202a152%20152%200%200025%206l5%201c4%201%204%201%204-48%200-40%200-43-2-43v-1c3%200%203-6%200-8v-2c3%200%202-4%200-5v-1c2%200%202%200%202-2l-1-4c0-3%200-3-6-3h-7l1%201%201%201c0%201%201%202%203%202l3-1%201-1%201%201v1a236%20236%200%2001-34-2c2%200%203-1%203-2l1-1%201%202c-1%201%200%201%202%201l2-1h4c0%202%201%202%205%202%209-2%206-4-7-4a1272%201272%200%2001-48-4c-6%200-6%200-6%202s3%203%203%201h1l2%201c1%201%200%201-2%201-4%200-5%200-5%204%200%203%200%204%202%204l2-1h1c0%202-1%202-3%202l-3%201%201%201a389%20389%200%200131%204h-1a214%20214%200%2000-36-3c1-1%203-16%202-17l-1%201h-3l-2%205v22c-1%206-1%207%202%207%202%200%201%201-3%203l-6%203-17-2c-18-2-25-4-17-4%203%200%203%200%201-1-2%200-2-1%201-2l2-2%201-3%201-2c-1-1-2-2-10-2-6-1-6-1-5-3h2l4%201h8l4%201h1l1%201h4c2%201%203%201%203-1%200-1%205-1%206%201h1c1-1%200-2-1-3v-1c3-1%202-3-2-3-3%200-3%200-1-2h2c0%202%203%201%203%200l-1-2v-1l1-3%201-6%201-4h-8l-15-1c-6%200-7%200-7%202l2%201h2l-5%201c-5%200-5%200-3-1%207-2%203-4-16-5a512%20512%200%2001-35%200v2c-2%200-3%202-2%205v6c0%204%200%204-4%204-3%200-3%200-3%203l-1%202c-2%200-1%204%201%204v1l-2%202c-2%202-6%202-7%200l-4-3c-3-1-3-1-1-1v-2l1-2c0-2-1-2-4-2s-3%200-2-1l2-1%202%201h4l1%201-1-7v-1c2-2%201-14-1-14a755%20755%200%2001-20%201c2-1%202-1%202%202l-1%203v-2c0-2%200-2-3-2h-3v8c1%207%201%208-1%208-1%200-2-1-2-3l-1-4v-5l-1-4-2-1%202-1%201-1-12%201-11%201%201%207v8l-7%202c-12%202-12%202-12%205%201%203-1%204-3%202v-4c-2%200%202-3%204-3s2-1%202-7l-1-7a254%20254%200%2000-42%208c1%201%200%202-1%202l-1-1c0-2%200-3-2-3s-1-1%205-8l8-7%209-1%2017-2h9l2%203c2%203%202%204%204%203%203%200%203%200%203-4%200-3%201-3%205-4%2011-2%2025-3%2038-3%2017%201%2017%201%2019%206%201%204%201%204%206%204l4-1c-1-1%202-5%204-6l44%201c45%202%2044%202%2046%207%201%204%202%205%209%205h7l4-4%204-5h16l38%202%2023%201v3c1%202%201-4%201-14%200-18%200-20-3-20-2%200-3-2-1-5l1-6c1-7%201-6%202%202l1%208v-8l-1-8V3l-1-2a323%20323%200%2000-35%201h-3l-5-1h-28l-2%201-1%202h-1l-1-2-1%202v1l-2-2%201-3h-25v6l1%205%201-1V9l1%201c0%201%201%201%201-1%201-2%200-3-1-3l-1-2c0-2%201-3%203-3%203%200%203%202%200%202-2%201-2%201%200%201%203%200%204%202%202%202l-1%203c0%202%200%202%201%201%200-2%201-2%201-1h1c2-1%202-2%200-2-1-1%203-1%209-1h11v8l1-5c1-4%203-5%204-2%201%201%201%200%201-1-1-3%201-4%202-2%200%201%201%202%203%201%202%200%202%200%202%203s0%204%203%205l3%201-1%207c-2%206-4%209-5%207l-4-1c-3%200-4%200-4-2s1-2%203-2c3%200%203%200%202-1h-32l-3-1c-4%200-4%200-4%205v6c1%204-2%206-7%205-4%200-7-3-3-3l1-1%201-2%201-10%202-13c1-7%201-8-1-8l-2%202-2%201-3%201h-3c-1%202-4%201-4%200l2-2%201-1-3-1c-3%200-4%201-4%202l-1%202V2c0-2%200-2-9-2l-9%201c-1%202%200%204%203%204%201%201%200%201-2%201l-3-1h-3l-4-1%202-1%201-1h-1l-2-1-3-1c-4%200-4%202-1%204%202%200%202%201%202%2013l-1%2013-1-18-2-6-1-3-2-1-3-1c0-3-3-1-3%202l-1%204V0h-61a788%20788%200%2000-29%202c1%202%206%202%2010%201%202-1%202-1%202%201l2%201%204%202%202%202h-6v12l-1-6-1-6-1%208c0%204%200%205-2%205s-4-3-4-8c0-4%200-5-2-6-3-2-5-1-5%201h-1c-1-1-7-2-8-1h-2l-9-1-13-1h-4v3c0%203%200%204-2%204v-1c3-2%201-4-5-5L82%206l-5%201h-5a193%20193%200%2000-17-3c2%200%202%200%201-1V2l2-1-18-1C30%200%2022%200%2023%201m289%207c-2%200-2%201-2%204v4h9l-6%201-4%201h14v-5l-1-5h-10M21%2046c-3%200-5%201-5%203l-2%203c-3%203-2%206%204%206%205%200%205%200%209-3l5-3v-1h1l1-1v-2c1-1%200-1-1-1-3%200-3%200-2-1H21m17%209c-2%202-3%202-5%202-2-1-3%200-5%201-1%202-1%202%201%202%202-1%203-1%200%202l-3%201-1%201-1%201-1%201v2c-3%201%202%204%205%204s4%200%203%202l3%201c3%200%203%200%202-2-3-2-2-2%205-2%2010%201%2012%201%2011-3%200-3%200-3%202-3l2-2%202-2%201-3v-2H49c-8%200-9%200-8-2%202-2%200-1-3%201m112%2021c-1%202-6%203-6%202l-2%201c-2%202-2%206%201%206l1%201h1l5-1h8c5-1%205-1%206%201%201%204%202%200%201-4-1-5-2-6-8-5l-6-1h-1m-73%206l-3%201a217%20217%200%2000-24%205l-2%201c-1%201-1%201%201%201%201%200%202%201%202%203v4l-2%201-4%201c-1%201-4-1-4-2l4-1c3-1%204-1%203-2l-2-1h-1l-1-1v2l-1%201c-1%200-2%200-1-1l-1-1-1-2c0-3-1-2-6%202l-13%2013c-13%2013-13%2013-6%2012a43%2043%200%20008%200%20216%20216%200%200022-5l3-2h7l1%201v-1l1-1c2-1%202-1%201-2l-1-7-2-9v-4l11-2c12-2%2012-2%2012-4h-1m72%2021c-21%207-22%208-21%209l-2%202-3%201-3%202c-4%201-6%204-2%203%202-1%203%201%201%202v4c-2%202-2%202-3-2%200-3-1-4-2-4l-1%207c0%207%200%208-3%207s-3-4%200-4c3%201%203%200%200-2l-3-2v-2c0-1-1-2-2-1l-1-1c1-1%201-1-1-1h-4c-2-2-8%200-27%206-63%2019-65%2019-63%2021l-2%203c-3%202-2%204%202%203l15-4%2012-2-2%201-3%202c0%202%200%202%203%201%204%200%204%203%200%205-1%200-2%200-1%201l3-1c3-1%203-1%202-3v-5l-1-2c-3%200%200-1%2012-5%2013-4%2016-4%2013-2-1%202-1%203%201%203l1%201%201%203%201-2-1-2-1-3c0-3%201-3%206-4l5-2c1%200%201%202-1%204h2c1%200%202-1%201-2-1-3%200-3%205-4l5-1-1%201-1%202%202%201%201-3c0-2%201-3%208-5l9-3v8a1100%201100%200%20001%2012c-4%200-8%202-8%204l1%202%201-1c-1-1%200-1%201-1l12-3c12-5%2012-5%2012%204l1%207c1%200-1%202-7%205l-5%203c2%200%203%200%202%201-3%202%202%202%205%200l6-2%205-2c4-3%207-6%206-7l1-1%202%205c0%204%201%205%202%202l2-1c1%201%201-1%201-4%200-5%200-6-2-6s-3-4-3-11c0-4%201-4%207-7l8-3%203-1-3-1-7%201h-5v1l-2%202c-6%202-7%203-6%206%200%202%200%202-3%203l-5%201c-3%202-3%202-3-6l-2-8c0-3%203-6%204-4l1-1-1-2h-3l5-2a1353%201353%200%200030-10c3%200%205%201%203%202v1l1%202h3c1%201%202%204%201%205v2l1%202v2c1%202%201%202-1%202l-2%201-4%201-3%201v6c0%2010%201%2010%2011%206l9-4%201%206v6l9%201%2010%203%203%201%2018%203c2%200%204-1%202-2-2-2-1-4%201-4l2-1%202-2c1-2%201-2%203-1h1l1-2%201%201h1v-2h2l1%201%201-2s1-2%203-2l2-2v-14h4l3-1-3-1-3-1%201-1%201-1-1-2-2-1c0-2%202-3%202-1l18%204%2018%203%2015%202%204-2%208-3c3-1%203-1-5-3a325%20325%200%2000-27-3c-4-3-24-4-24-1l-2%201h-8l-1-1-1%201h-1l-2-1-6%201-1-1c-10-3-12-3-14-2-1%201%200%201%203%201l5%203c0%201-2%202-2%200h-4c-4%200-3%201%202%202l4%202-2%201h-3l2%201c4%201%204%203%200%203h-3l3%201%203%202c0%202%200%202-2%200h-4v1l5%202c1%201%201%201-2%201h-3l3%201%203%202a1382%201382%200%2000-38-7h-4l-6-1c-3%200-4-1-2-3v-1l-1-6c0-6%200-7%202-7l2%202%201%202v-2h4c5%200%205%200%204-2h-1l-1%201v-1l-1-1h-2%207c2%200%203%201%202%202l1%202%202-2%208-1h7l-2-1h-2l-1-1-4-3c-2-2-3-3-13-4-14-3-14-3-36%204m109%2038h-2l-17%207c-1%202%2011%205%2016%205h6l28%207c9%201%2011%201%2011-5l-1-5-1-1h-3l-1-1h-3l-4-1-4-1-4-1h-4l-4-1h-1l-1-1h-1c-1%201-1%201-1-1s-4-1-4%200h-2l-2-1h-1M96%20153a154%20154%200%2001-28%2011l-18%207h-3c0%201-2%203-5%204-4%201-5%202-3%202l3%203c0%203%201%202%2012-3%209-3%2012-3%2013%201l2%202c3%200%2024-9%2028-12h1l1-1%201-1c2%201%202%200%202-3v-5c1-2-1-7-2-7l-4%202m78%206c-5%203-6%205-3%204%202-1%202-1%202%202l-1%203v1c2%200%203%202%201%202l-1%201%201%201c1-1%201%200%201%202s-1%203-8%208l-10%206-4%203c-2%202-3%201-3-1s-2-1-6%205l-5%209%206-3%207-4%201%207%201%208-5%204c-3%202-4%204-3%204l6%201c8%200%209%200%2013-3a78%2078%200%200118-11c-1%200%202-4%204-4v1c0%202%201%205%202%204h6l6%201h2l2%201%202%202h5l6%202c3%200%203%200%202-5l1-6%202-3c0-2%203-3%208-1%202%201%203%201%204-1%202-1%202-1%204%203s3%205%207%206c11%204%2011%204%2011%209-1%205%200%206%207%208%205%202%2010%202%2010%200l2-2%201-4%201-2c1-1%2019%204%2020%206l-1%207-2%209-1%204c-1%201-1%202%201%202l1%202c0%202%208%206%209%205l2%201h1l1%201c1%201%201%201%202-1%201-3%201-3%205-1h8c-1%202%201%203%201%202%201-1%201%200%201%202-1%204%200%205%202%204h1l3%204c4%202%204%203%200%205-4%203%200%202%206-1s6-3%207-2%204%203%209%204c7%201%208%202%209%204%201%204%201%202%209-23l4-14-6-1-6-3v-1l-1%201-1%201-1-2h-1c-1%201-4%200-3-2l2-1%201-2h-1c-1%202-2%201-1-1%200-1%201-2%202-1%202%200%202%200%201-1-4-3-3-4%201-4l4%201-4-1c-3-1-4-4-2-4l2-1-1-1-1-2h2a688%20688%200%20005-1l-2-1c0-3%201-2%2011%200%207%202%208%203%208%201v-2a6796%206796%200%2000-162-39c-2%203-4%203-4%200l1-2%201%201h1a2514%202514%200%2001-40-13l-6%203m6%201l1%201%205%201c4%202%202%202-3%201-4-2-5-2-5%201v4c-2%200-1%209%201%2010l2%201%205%201c3%201%206%202%207%201l2%201%201%201h1l3%201%205%201h3l-3-2c-4-1-5-2-1-1%204%200%205-1%202-3v-1c1%201%202%200%202-1l-2-1-2%202-2%201-3-1-1-1h3c2%200%202%200%201-1-2-2-2-2%202-2%205%201%205-1-1-2-2-1-4-2-2-2l4%201c3%201%203%201%203-2l-1-3c-16-5-27-8-27-6m57%2015c1%202-2%203-5%201l-4-1v15l-1%202%206%201c1%200%202%200%201%201l2%201h2l2%201%204%201c1%202%207%203%207%201l-2-2c-2%200-1-2%202-2v1c-1%201-1%201%202%201%204%200%205%200%204%201l-3%201c-2-1-3%201%200%202l3%202%201-1v-1l2%201%204%202%204%201h2l3%201c1%202%203%202%204%202%202-1%202-1-1-2l-11-4-6-3h4l2%201c0%201%204%202%207%201l-1-1c-1-1-1-1%201-1h2l3%201%203%201c0%202%203%201%203%200%201-2%200-2-1-2l-5-1c-2-2-1-2%202-1h6l1%201-1%202v1c2%201%201%203-2%202l-3%201%202%202%203%201%203%201h4c1-1%200-2-2-3s-2-1%200-1l3-1-1-1v-1h3c2%203%203%206%200%206-2%200-3%202-3%206l4%201%204%202h5l-3-3-2-1h3c2%201%203%200%203-1l4-2%203-1c-2%200-2%200%200-2l1-2c-3%200-1-2%202-2s4%200%203%202l1%201%201-1%202-1-4-2c-6-2-11-3-8-1v3l-1%202c1%201%200%202-1%202v-3c0-2%200-2-2-2l-2%202-2%201c-2%200-2-3%201-3l-4-2-4-2h4l4%201%203%201%201%201c6%200-8-7-15-7-2%200-1%203%201%203%201%201%201%201-1%201l-6-2-5-1h-2l-4-2-3-1h3c4%200%205-2%201-2l-3-3h1c1%201%206%203%206%201%200-1-2-2-7-3-2-1-2-1-2%201%201%201%200%202-1%202v2c2%202%202%202-2%201-3%200-3%200-2%201%203%203%202%203-3%202-3-2-4-2-1-2%202%201%203%200%203-1l-2-1v-1h2l1-1-2-2-1-1c3-1%202-3-2-4-5-1-5-1-5%201l2%201%201%201-2%201-2%201h4c2%200%203%200%202%201v1c1%201%200%201-1%201-2%200-2%200-2%202%201%201%200%201-1%201l-2%202-2%201v-8l-1%201c1%202%200%203-3%202h-3c0%201%201%202%203%202l3%202-5-1c-4-1-5-2-4-3l-2-2-2-3%202%201h2l-1-2c-1-1-1-1%201-1v-3c-2%200-2-1-1-1l1-1-1-2-4-1-2%201m-54%2018c-4%203-5%205-4%207%202%202%206%203%207%201%201-1%206%200%2011%202s8%201%208-3%200-4-8-6l-10-3-4%202m124%2018l1%202v1c-2%200-3%203%200%203h2l3%201c1-1%202-1%202%201l2%201c2-1%203%200%204%201%201%202%206%203%206%201l1-4c0-2-1-2-9-5-12-3-12-4-12-2M56%20222l-5%204c-1%202-2%202-2%201%200-2-3%200-3%202-1%202%200%203%202%201l2-1-1%201v3l-3%201h-3l-1%204c1%200%2017-9%2016-10-2-1-1-4%202-5s3-2%201-2l-5%201m30%209l-4%202c-1%202-2%202-2%201h-1c0%203-11%209-11%207l-3%202c-3%204-4%204-4%200l-2-3%201-2v-1c-1-2-2-2-3%200l-3%202-1%202h3c3-2%202%200-1%202l-3%201-1%201v3l-1-1-1-1-1%202-2%202v-6c-2-1-2-2%200-2v-3h-1l-2%202v2c1%200%201%201-1%203-1%202-2%202-2%200l-3-1c-2%201-3-3%200-4%201%200%201-1-1-2l-2-2%202-1c2-1%202-2%201-2-1-1-11%204-11%205l-1%201c-1-1-7%202-7%203%200%202%2016%2014%2019%2014s3-2%201-3c-2-2-1-2%203-4%202-1%203-2%203%200l-2%201-2%202c0%202%201%203%203%201l2-1-2%203c-4%203-4%204-1%204l2%202c-1%201%2011%2016%2012%2016l1-1%201-1%2013%208h2c1-2%201-2-1-4-3-2-2-4%201-2%201%201%202%201%204-1l1-2-6-6%204%202c2%202%204%202%205%201s0-4-2-5l-2-1-2-2h-1l-1%201-2-1h-2v-2c0-2%202-4%203-4v2c-1%203-1%203%201%202h1l2%201%203%201%202%201%201%201h2v-2l-2-2-3-2h-4v-1l-1-2c-1%201-1%200-1-1l2-2%201%201%202%201v-2l-1-1c-2%200%200-5%202-6l2-2%202-3%201-3%202-2%202-3%202-2c1%200%202-3%200-3l-4%202'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":1.3304721030042919,"src":"/static/8f504235e1fa14acfd407961a2faba5b/77467/0_nZdxaCo7brmUEBfj.jpg","srcSet":"/static/8f504235e1fa14acfd407961a2faba5b/dece2/0_nZdxaCo7brmUEBfj.jpg 310w,\n/static/8f504235e1fa14acfd407961a2faba5b/fcb16/0_nZdxaCo7brmUEBfj.jpg 620w,\n/static/8f504235e1fa14acfd407961a2faba5b/77467/0_nZdxaCo7brmUEBfj.jpg 1240w,\n/static/8f504235e1fa14acfd407961a2faba5b/b1020/0_nZdxaCo7brmUEBfj.jpg 1860w,\n/static/8f504235e1fa14acfd407961a2faba5b/88564/0_nZdxaCo7brmUEBfj.jpg 2480w,\n/static/8f504235e1fa14acfd407961a2faba5b/de9c6/0_nZdxaCo7brmUEBfj.jpg 4000w","sizes":"(max-width: 1240px) 100vw, 1240px"}}},"author":"Tobias Fischer","source":"https://unsplash.com/@tofi","sourceText":"Unsplash","is_cover":1,"galleryId":0}]}}},"pageContext":{"id":"a0763678-10c1-5bee-9fe5-9d204188c565"}}}