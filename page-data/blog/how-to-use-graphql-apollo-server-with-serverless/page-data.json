{"componentChunkName":"component---src-components-blog-page-layout-blog-page-layout-tsx","path":"/blog/how-to-use-graphql-apollo-server-with-serverless","result":{"data":{"mdx":{"id":"18584ed9-f311-5ad3-889c-6fd97f97a727","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"How to use GraphQL Apollo server with Serverless\",\n  \"description\": \"In the previous article, we have discussed how to use Serverless locally with Webpack and then deploy it to the AWS cloud. Today we talk about how to spin up Apollo GraphQL server inside a lambda function.\",\n  \"keywords\": \"serverless, graphql, apollo, nodejs, webpack, aws, lambda\",\n  \"path\": \"/blog/how-to-use-graphql-apollo-server-with-serverless\",\n  \"date\": \"2018-12-28T00:00:00.000Z\",\n  \"published\": true,\n  \"images\": [{\n    \"author\": \"Chor Hung Tsang\",\n    \"image\": \"/assets/blog/0_BQNcJ9ASkBDCLP27.jpg\",\n    \"sourceText\": \"Unsplash\",\n    \"source\": \"https://unsplash.com/@chortsang\",\n    \"is_cover\": 1,\n    \"galleryId\": 0\n  }]\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"In the previous article, we have discussed \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/blog/how-to-use-serverless-with-webpack-and-docker\"\n  }), \"how to use Serverless locally with Webpack and then deploy it to the AWS cloud\"), \". Today we talk about how to spin up \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Apollo GraphQL server\"), \" inside a lambda function.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GraphQL\"), \" is a good alternative to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"REST\"), \". It has both upsides and downsides, but useful when dealing with complexly structured, deeply nested rich data. \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GraphQL\"), \" allows us to pick only the requested subset of data we need to display client-side in each particular case.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Apollo\"), \" is one of two widely-used implementations of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GraphQL\"), \", it includes both server and client, and considered to be a simpler one.\"), mdx(\"p\", null, \"Done with theory.\"), mdx(\"h2\", null, \"Step 1: Starter code {a}\"), mdx(\"p\", null, \"I am going to use \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/gannochenko/poc_serverless-offline-webpack-docker\"\n  }), \"a repository from the previous article\"), \" as starter code here. Feel free to clone it, or come up with something of your own.\"), mdx(\"p\", null, \"So, in case we decided to proceed with the repository, rename folder \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./lambda-app\"), \" to something more relevant, like \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app\")), mdx(\"p\", null, \"Also, just to be cool, in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./serverless.yml\"), \" we could change the function name and the endpoint name from \\u201Chello\\u201D to \\u201Cgraphql\\u201D.\"), mdx(\"p\", null, \"Don\\u2019t forget to run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm install\"), \" inside \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app\"), \", if the repository is freshly-cloned.\"), mdx(\"h2\", null, \"Step 2: Install packages {a}\"), mdx(\"p\", null, \"The key packages this time would be:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"apollo-server-lambda\"), \" \\u2014 a binding for the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"apollo-server\"), \" package on \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"serverless\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"graphql-tag\"), \" \\u2014 contains \", \"*\", \".graphql file loader for babel\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"graphql\"), \" \\u2014 a peer package for \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"graphql-tag\"), \" (\\u201Cpeer package\\u201D means that \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"graphql-tag\"), \" is an add-on for graphql and cannot dictate what version of graphql to install)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"merge-graphql-schemas\"), \" \\u2014 allows to compose different type declarations into one structure, so we can properly split the code\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"cd ./graphql.app\\nnpm install apollo-server-lambda merge-graphql-schemas axios\\nnpm install graphql-tag graphql --save-dev\\n\")), mdx(\"h2\", null, \"Step 3: Types {a}\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GraphQL\"), \" is a strictly typed language. It means that it needs to know all data types we are going to use. For demo purposes, we are going to create a simple dataset based on famous \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://swapi.co/\"\n  }), \"https://swapi.co/\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"mkdir -p ./src/graphql/types\\n\")), mdx(\"p\", null, \"We create \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"graphql.app/src/graphql/types/index.js\"), \" file:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"import { mergeTypes } from 'merge-graphql-schemas';\\n\\nimport movie from './movie.graphql';\\nimport character from './character.graphql';\\n\\nexport default mergeTypes([movie, character], { all: true });\\n\")), mdx(\"p\", null, \"Now declare types. There will be two files, one for movies and another \\u2014 for characters. We will not be digging too deep into the GraphQL syntax, it really goes beyond the scope, but at least we can see how resolvers work, and how to make queries with parameters and without ones.\"), mdx(\"p\", null, \"So,\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/types/movie.graphql\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"type Movie {\\n    id: String!\\n    title: String!\\n    characters: [Character]!\\n}\\n\\ntype Query {\\n    movies: [Movie]\\n    movie(id: String!): Movie!\\n}\\n\")), mdx(\"p\", null, \"There are so-called root types in the declaration, it could be \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Query\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Mutation\"), \" and several other, each is specific for different situations. So, consider the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Query\"), \" type to be an \\u201Centry point\\u201D of your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GraphQL API\"), \".\"), mdx(\"p\", null, \"Square brackets mean that an array of values is expected. Exclamation mark means the attribute is mandatory.\"), mdx(\"p\", null, \"A similar file is for characters:\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/types/character.graphql\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"type Character {\\n    id: String!\\n    fullName: String!\\n    movies: [Movie]!\\n}\\n\\ntype Query {\\n    character(id: String!): Character!\\n}\\n\")), mdx(\"p\", null, \"Note, that \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"*.graphql\"), \" files are written in a special kind of language, different from JavaScript. In order to import such kind of files, we need a special loader \\u2014 a plugin for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Babel\"), \", which reads the file and translates the declared types into an \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"abstract syntax tree\"), \" (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AST\"), \") structures. After that, we combine these structures into one big super-structure with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"merge-graphql-schemas\"), \" module.\"), mdx(\"p\", null, \"So let\\u2019s enable the loader in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./webpack.config.js\"), \" file. Find the section with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"module: {rules: [\\u2026]}\"), \" and insert a new rule into the array:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"{\\n  test: /\\\\.(graphql|gql)$/,\\n  exclude: /node_modules/,\\n  loader: 'graphql-tag/loader',\\n},\\n\")), mdx(\"p\", null, \"Now that should work.\"), mdx(\"h2\", null, \"Step 4: Resolvers {a}\"), mdx(\"p\", null, \"In \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GraphQL\"), \" each complex type can have its own resolver. Typically, a resolver is an asynchronous function which acquires data from a (usually) remote source. This is a key feature of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GraphQL\"), \": when a certain data subset is requested, only the corresponding resolvers get executed.\"), mdx(\"p\", null, \"Resolvers are mandatory for root types because the GraphQL server needs to know which code to execute in order to process the request. On the contrary, basic types like String, Int, Boolean and so on do not require a resolver.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"mkdir -p ./src/graphql/resolvers\\n\")), mdx(\"p\", null, \"Just like before, we create \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/resolvers/index.js\"), \". Inside the file, we also use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"merge-graphql-schemas\"), \" to compose different resolvers into one declaration.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"import { mergeResolvers } from 'merge-graphql-schemas';\\nimport movieResolver from './movie';\\nimport characterResolver from './character';\\n\\nconst resolvers = [movieResolver, characterResolver];\\n\\nexport default mergeResolvers(resolvers);\\n\")), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/resolvers/movie.js\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"export default {\\n    Query: {\\n        movies: async (source, args, { dataSources }, state) => {\\n            return dataSources.movieSource(null);\\n        },\\n        movie: async (source, args, { dataSources }, state) => {\\n            // by using \\\"args\\\" argument we can get access\\n            // to query arguments\\n            const { id } = args;\\n\\n            const result = dataSources.movieSource([id]);\\n            if (result && result[0]) {\\n                return result[0];\\n            }\\n\\n            return null;\\n        },\\n    },\\n\\n    Movie: {\\n        characters: async (source, args, { dataSources }) => {\\n            console.dir('Executing Movie.characters resolver');\\n            return dataSources.characterSource(source.characters);\\n        },\\n    },\\n};\\n\")), mdx(\"p\", null, \"A resolver function receives four arguments:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"source\"), \" \\u2014 an object that contains values from the parent resolver. In case we would like to get characters, the source will contain \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"[1, 2, 3]\"), \",\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"args\"), \" \\u2014 gives access to query parameters. In case we call for \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"movie\"), \", args will be containing \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"id\"), \" key,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"context\"), \" \\u2014 an object that is shared between all resolvers within the query, it can contain an authentication token, a \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"dataSources\"), \" object which we will be passing as a parameter when creating the server,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"state\"), \" \\u2014 an advanced argument which contains information about the current query. The most interesting part is an \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"AST\"), \" point of the query the resolver was executed at.\")), mdx(\"p\", null, \"Now, the other one, for characters:\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/resolvers/character.js\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"export default {\\n    Character: {\\n        movies: async (source, args, { dataSources }, state) => {\\n            return dataSources.movieSource(source.movies);\\n        },\\n    },\\n};\\n\")), mdx(\"h2\", null, \"Step 5: Data sources {a}\"), mdx(\"p\", null, \"Here I would like to illustrate something. As I have already mentioned before, resolvers can get data from different sources, asynchronous or not.\"), mdx(\"p\", null, \"So, let\\u2019s make those two data sources, for both movies and characters.\"), mdx(\"p\", null, \"For the movies, the data source would be just a local array.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/dataSources/movie.js\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"const movies = [\\n    {\\n        id: '1',\\n        title: 'A New Hope',\\n        characters: [1, 2, 3, 4, 5],\\n    },\\n    {\\n        id: '2',\\n        title: 'The Empire Strikes Back',\\n        characters: [1, 2, 3],\\n    },\\n    {\\n        id: '3',\\n        title: 'Return of the Jedi',\\n        characters: [30, 31, 45],\\n    },\\n];\\n\\nexport default ids => {\\n    if (ids === null) {\\n        return movies;\\n    }\\n\\n    return movies.filter(movie => ids.indexOf(movie.id) >= 0);\\n};\\n\")), mdx(\"p\", null, \"For characters, the data source is a little bit more complex, so it gets data from a remote source and process the result in order to make it suitable for us. We also use super-simple memoization technique there, just to make it work a little bit faster.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/graphql/dataSources/character.js\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"import axios from 'axios';\\n\\n// such kind of memoization is not good for production\\n// use it like this only for demo purposes,\\n// normally it is better to have something\\n// like Redis here\\nconst cache = {};\\n\\nconst extractId = url => {\\n    const found = url.match(/(\\\\d+)\\\\/$/);\\n    if (found.length) {\\n        return found[1];\\n    }\\n\\n    return null;\\n};\\n\\nexport default async ids => {\\n    if (!ids || !ids.length) {\\n        return [];\\n    }\\n\\n    const result = [];\\n    const missing = [];\\n    ids.forEach(id => {\\n        // check what we already have in the cache\\n        if (cache[id]) {\\n            result.push(cache[id]);\\n        } else {\\n            missing.push(id);\\n        }\\n    });\\n\\n    if (missing.length) {\\n        // still having cache miss? request then!\\n        (await Promise.all(\\n            missing.map(id =>\\n                axios\\n                    .get(`https://swapi.co/api/people/${id}/`)\\n                    .catch(() => null),\\n            ),\\n        )).forEach(res => {\\n            // process the result as it does not\\n            // have an appropriate format\\n            if (res) {\\n                const data = res.data;\\n                const id = extractId(data.url);\\n                if (id) {\\n                    const character = {\\n                        id,\\n                        fullName: data.name,\\n                        movies: data.films.map(filmURL => extractId(filmURL)),\\n                    };\\n\\n                    // put to the cache\\n                    cache[character.id] = character;\\n                    // and to the result\\n                    result.push(character);\\n                }\\n            }\\n        });\\n    }\\n\\n    return result.filter(x => !!x);\\n};\\n\")), mdx(\"h2\", null, \"Step 6: The handler {a}\"), mdx(\"p\", null, \"It is time to modify our handler code. Edit the file \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"./graphql.app/src/index.js\"), \" like the following:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-js\"\n  }), \"import { ApolloServer } from 'apollo-server-lambda';\\nimport resolvers from './graphql/resolvers';\\nimport typeDefs from './graphql/types';\\nimport characterSource from './graphql/dataSources/character';\\nimport movieSource from './graphql/dataSources/movie';\\n\\n// creating the server\\nconst server = new ApolloServer({\\n    // passing types and resolvers to the server\\n    typeDefs,\\n    resolvers,\\n\\n    // initial context state, will be available in resolvers\\n    context: () => ({}),\\n\\n    // an object that goes to the \\\"context\\\" argument\\n    // when executing resolvers\\n    dataSources: () => {\\n        return {\\n            characterSource,\\n            movieSource,\\n        };\\n    },\\n});\\n\\nconst handler = (event, context, callback) => {\\n    const handler = server.createHandler();\\n\\n    // tell AWS lambda we do not want to wait for NodeJS event loop\\n    // to be empty in order to send the response\\n    context.callbackWaitsForEmptyEventLoop = false;\\n\\n    // process the request\\n    return handler(event, context, callback);\\n};\\n\\nexport default handler;\\n\")), mdx(\"p\", null, \"You may have a question appeared though: \\u201CHmm, but if this code is executed every time the function gets executed, isn\\u2019t it too much to start the ApolloServer on each hit?\\u201D. Answer: when you start your application and receive a very first hit, the lambda function executes all the code and moves from \\u201Ccold\\u201D state to \\u201Cwarm\\u201D. If another hit comes within a range of several seconds, it causes execution of only the handler code, while all the object produced with the local, outer code remain the same. It dramatically improves performance.\"), mdx(\"h2\", null, \"Step 7: Launch the application {a}\"), mdx(\"p\", null, \"All set, spinning up\\u2026\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-bash\"\n  }), \"npx serverless offline start -r eu-central-1 --noTimeout --port 3000 --host 0.0.0.0\\n\")), mdx(\"p\", null, \"Hopefully, no error occurred, and our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GraphQL Serverless endpoint\"), \" is now online \\uD83D\\uDE80. We could also deploy this application into the wild, the process of how to do so is described in the previous article.\"), mdx(\"h2\", null, \"Step 8: Playing around {a}\"), mdx(\"p\", null, \"Apollo server offers a pretty web-interface to play nicely with different queries. To access the interface, just make a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GET\"), \" request to the endpoint:\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http://localhost:3000/graphql\")), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"690px\"\n    }\n  }), \"\\n      \", mdx(\"a\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-link\",\n    \"href\": \"/static/d98b449ff24209a1d7e6426081a15279/15ec7/1_vwq6A6ySyQNUEtCvYy7e8g.jpg\",\n    \"style\": {\n      \"display\": \"block\"\n    },\n    \"target\": \"_blank\",\n    \"rel\": \"noopener\"\n  }), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"93.05019305019306%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIBBf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB5OTes6wkWKB//8QAGRAAAgMBAAAAAAAAAAAAAAAAAREAAiAh/9oACAEBAAEFAuEqCr3/AP/EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABgQAAIDAAAAAAAAAAAAAAAAAAEQICEx/9oACAEBAAY/ArWif//EABoQAAICAwAAAAAAAAAAAAAAAAABETEgYXH/2gAIAQEAAT8hUCq0iAtKO5//2gAMAwEAAgADAAAAEDMfAv/EABcRAQADAAAAAAAAAAAAAAAAAAABECH/2gAIAQMBAT8Qamv/xAAWEQADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQIBAT8QI//EABoQAQADAQEBAAAAAAAAAAAAAAEAETEhEIH/2gAIAQEAAT8QNkVetifJdhErwtUqYaQzw0jx8//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Heroes\",\n    \"title\": \"Heroes\",\n    \"src\": \"/static/d98b449ff24209a1d7e6426081a15279/15ec7/1_vwq6A6ySyQNUEtCvYy7e8g.jpg\",\n    \"srcSet\": [\"/static/d98b449ff24209a1d7e6426081a15279/8356d/1_vwq6A6ySyQNUEtCvYy7e8g.jpg 259w\", \"/static/d98b449ff24209a1d7e6426081a15279/bc760/1_vwq6A6ySyQNUEtCvYy7e8g.jpg 518w\", \"/static/d98b449ff24209a1d7e6426081a15279/15ec7/1_vwq6A6ySyQNUEtCvYy7e8g.jpg 690w\"],\n    \"sizes\": \"(max-width: 690px) 100vw, 690px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n  \"), \"\\n    \")), mdx(\"p\", null, \"First, try to execute a quite complex query, like this one:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"query {\\n    movies {\\n        title\\n        characters {\\n            id\\n            fullName\\n        }\\n    }\\n}\\n\")), mdx(\"p\", null, \"You will notice, that in the console a message \\u201CExecuting Movie.characters resolver\\u201D appeared 3 times, once per each movie item. Now, if we try the following query:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"query {\\n    movies {\\n        id\\n        title\\n    }\\n}\\n\")), mdx(\"p\", null, \"We got no messages like that anymore because we have not requested \\u201Ccharacters\\u201D. It means, that resolvers and therefore data sources get executed on-demand, and it definitely adds some flexibility to our code.\"), mdx(\"p\", null, \"You may notice, that when declaring types, we have introduced a cyclic link: Movies \\u2192 Characters \\u2192 Movies \\u2192 Characters \\u2192\\u2026 So, we could also try to make a query like this, and technically it will work!\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"query {\\n    movies {\\n        title\\n        characters {\\n            fullName\\n            movies {\\n                title\\n                characters {\\n                    fullName\\n                    movies {\\n                        title\\n                    }\\n                }\\n            }\\n        }\\n    }\\n}\\n\")), mdx(\"p\", null, \"How cool is that?\"), mdx(\"p\", null, \"What we could also do is to send a parametrized query because we have declared it in our types:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"query {\\n    movie(id: \\\"1\\\") {\\n        id\\n        title\\n        characters {\\n            fullName\\n        }\\n    }\\n}\\n\")), mdx(\"p\", null, \"The parameter could be something more complex, than just a string. We could have created a query that accepts objects or arrays, this is useful to make a rich query that can do filtering or sorting based on different criteria.\"), mdx(\"h2\", null, \"Conclusion {a}\"), mdx(\"p\", null, \"Now we know how to set up an Apollo GraphQL server working on lambda and run it locally and in production. We barely scratched the surface of GraphQL world, but this is already a production-ready use-case and could be a nice start.\"), mdx(\"h2\", null, \"Extra {a}\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"here is \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/gannochenko/poc_apollo-graphql-serverless\"\n  }), \"the Proof-of-concept repository\"), \" made for the article,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"read the \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.npmjs.com/package/apollo-server-lambda\"\n  }), \"official README for apollo-server-lambda\"))), mdx(\"p\", null, \"Thanks for reading! Hope this article was helpful for you. Happy GraphQL serving!\"), mdx(\"p\", null, \"Next article: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/blog/how-to-use-dynamodb-with-apollo-graphql-and-nodejs-serverless\"\n  }), \"How to use DynamoDB with Apollo GraphQL and NodeJS Serverless\"), \" \\u2192\"), mdx(\"p\", null, \"\\u2190 Previous article: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/blog/how-to-use-serverless-with-webpack-and-docker\"\n  }), \"How to use Serverless with Webpack and Docker locally and in production\")));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"title":"How to use GraphQL Apollo server with Serverless","date":"2018-12-28T00:00:00.000Z","keywords":"serverless, graphql, apollo, nodejs, webpack, aws, lambda","description":"In the previous article, we have discussed how to use Serverless locally with Webpack and then deploy it to the AWS cloud. Today we talk about how to spin up Apollo GraphQL server inside a lambda function.","published":true,"images":[{"image":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='267'%20viewBox='0%200%20400%20267'%20preserveAspectRatio='none'%3e%3cpath%20d='M0%2016l1%2016v1L0%2098v65h2l7-1c4-1%204-1%204%201s-2%203-4%203c-5%201-8%205-4%205v2c-1%201-1%201%202%201%205%200%205%201%200%202l-4%201h4l6%201c0%202-7%204-10%203l-3%201%202%201h1l2%202v1l-2%201%203%201%202-2%201-1%201%202%204%201c4-1%204-1%203%202-1%202-4%203-7%203l-1%202H3c-3%201-3%202-3%205l1%203c1%200%202%201%201%203l-1%202-1%2030v29h401v-38c0-33-1-38-2-39v-2c2-1%202-10%200-10v-1c3-1%201-3-2-3h-5c-2-2-2-2%203-2l5-1c0-2-1-2-5-2l-1-1%203-1c3%200%204-2%201-2l-28-1h-14c-7-1-7-1-7%201l-1%203c-1%200-2-1-1-3s1-2-10-1h-16c-3%200-4%200-4%202v3l-1-1-1-1c-1%201-1%200-1-1l-1-2c-1-1-2%200-2%201l-2%201-1-1-8-1c-13%200-13%200-13%202%200%203-3%203-3%200-1-3-4-4-6-2l-2%201-12-2h-11v3c0%203-2%203-7%200-3-2-22-3-23-1h-3l-2%201v2l1%201c4-1%206%200%206%202h-1l-5-1-3-1-2-3c-3-3-18-3-20-1-1%201-2%202-3%201l-2%201h-2c0-1-1-1-1%201h-2v-1c1%200%201-1-1-1-2-2-3-2-3%200%201%202%200%202-4%202-5%201-6%201-4-1s2-3%200-3l-5%201c-5%201-12%204-12%206l-3%201-3%201c-1%202-3%200-3-2s0-2%201%200c2%201%202%201%202-1%200-3%200-3%202-1v-1l1-3%201%202v1l1-2c0-2-1-2-4-2s-4%200-3%201l-3%201h-12c-6-1-9%200-9%203h-3l-4%201-1-1c-1-2-1-2-2%200%200%202-2%203-2%201h-1c0%202-2%203-2%201l-1-2-1%202c0%202-2%203-4%203l-1-1c0-3-2-2-3%200%200%202-2%203-3%203l-2%202-2%202-1-2h-1l-4%202c-1%200-2%200-1%202l-1%201-2-2-2-2c-2%200-2%201-2%203%201%203-2%204-6%202s-7-1-7%201%201%202%206%200l1%201-13%203c-2%201-3%200-3-1%200-2%200-2-3-1s-3%202-3%204v2c-1%201%200%201%202%201%203%200%203%200%201%201-6%202-9%202-8%201l1-3c0-2%200-2-1-1l-1%202-1-2%201-5%201-3%201-2c1-2%200-2-1-1-2%200-2%200-2-14%200-9%200-9-5-5-3%202-3%203-3%205v1h-3l-5%201c-4%200-5%201-5%203%200%203%200%203%203%203l3-1c0-2%206-2%209%200%202%201%202%201%200%203l-3%203-3%201h1c2-1%2010%201%2010%203l-4%202-4%202c-2%202-7%203-9%202l-2-1h-1l2-1%202-3%202-2c2-2%203-3%200-2l-2-1h-1l-1-1c-1-2-1-2-1%201l-1%203-2-5v-8c0-10%200-10%208-10h6l-1-9v-11c-2-1-8%201-8%203%201%201%200%202-5%202-7%201-6%203%200%203h6v4c0%204%201%204-11%205l-4%201%201-9-1-9-1%209-1%209-1-10c0-10%200-10%202-9l2-1v-1l2-2c0-5%200-5%207-4%207%200%208%200%207%202l1%205c1%201%201%200%201-6%200-9-1-10-4-10-2%200-2%200%200%201l2%203c0%202%200%202-2%201l-2-1c0%201-1%202-5%202l-4-1c2-1-1-3-4-2-3%200-3%200-3-3l1-4c2%200%201-2-1-2s-2%200%201-1c4-2%204-1%204%204l1%204%201-4c0-5%201-7%202-5%201%201%201%200%201-1%200-6%202-3%202%204l1%206v-7c0-4%201-7%202-7%201-2%201-2-1-2-2-1-1-3%202-3%203%201%206%203%204%204s-1%202%203%202l5%201c0%202-1%202-3%202-1%200-2%200-1-1v-2c-2%200-2%201-2%204l1%204v-1l1-1%203%201c2%200%201%204-1%206s-2%202%202%202l7%201c3%200%204%200%203%201v3c2%202%202%2011%200%2013s-1%205%201%203l1%205c1%204%200%204-2%204a134%20134%200%2000-9%201l-2%201%207%201%206%201v1l1-1%202-1v1l-1%201v1c-2%202-1%204%201%204l2%202-2%201-2%201%202%201c2-1%203%200%204%201%200%202-1%204-3%204s-1%202%203%203c2%200%204%201%204%203l1%204%201-3c-1-3%200-4%201-2l-1-9c-2-7-1-13%202-13%202%200%202%200%201%204v5h4c7%201%208%200%208-6l1-6v2c0%202%200%203%202%203v3c-3%200-2%201%202%202h3v-11h4c3%200%203%200%202%201-2%202-3%208-1%207s2%202%201%204c-3%201-2%202%201%202h4v-8c0-7%200-7%203-7%202%200%203%201%200%203v4c1%201%202%202%201%204l1%202c2%200%202-1%202-9%200-5%202-8%204-5v2c-2%200-1%205%201%205%202%201%202%201%202-3v-5h10v4l1%203%201-11c0-7%200-7%202-6%202%200%202%200%202-3l1-4%201%203c-1%203%200%204%203%203%202-1%202-3%200-5v-2l2-2c0-1-2-1-2%201-1%201-5%202-6%200l2-9%201%202v2l1-3c0-2%200-3%201-2%201%203%203%202%203-2l1-4%201%203%201%203%201-2c0-3%200-3%2010-3l11-1%203-1%203-1%204-1h4l-4%201c-3%200-3%201-2%202%203%202%2026%202%2029%200h1l18%201h39c1%202%206%203%208%201h2c0%201%2012%202%2012%200h2l1-1v-1l2%201c1%201%207%200%207-2l1-1%201%202c-1%202%200%202%205%202l10-1h4l36%201c30%200%2035%200%2034-2v-1l2%201%206%201c7%200%207-2%201-2l-4-1h3c5-2%202-3-4-3-4%200-5%200-5-2h4l3-1h1c2-2%205%200%205%202-1%202%200%202%202%202l2-1%202-1c1%201%204%200%204-1l-3-1h-4l6-3c3%200%203%200%203%204s0%204-4%205h-4l4%201h4v24l1-58V0h-41c-35%200-41%200-41%202s-2%201-2-1c-1-1-1-1-1%201l-1%202h-3c-1%201-4%200-4-1%201-1%200-1-1-1-2%200-3%200-2-1l-1-1-1%201h-1l-35-1a201%20201%200%2000-37%201l-6-1h-6v4c0%202%200%203-1%202V0H0v16m326-8c-2%203-2%204-3%2012%200%205-1%207-2%209l-1%202%202-1%203-2%201-1%201-1%201%201c-1%201%200%201%206%201l3%201h15v3c1%201%201%201%201-1%200-3%202-7%202-4%200%202%204%202%208-1%203-2%209-2%209%200l2%201c3%200%203-1%201-3l-21-1c-26%200-25%200-25-7%200-9-1-11-3-8m-126%206v4c0%202%200%202-4%202s-4%200-5-3l-1-3-1%202%201%207c0%203%200%205%201%204l1-1v2l1%201v-1l2-1h2l3-1%202%201c0%202%203%201%204%200l1-2v2c0%202%202%201%204-1%201-1%202-2%203-1l1-1%202-2c5-2%206-6%201-6-2%200-2%200%200-1%205-1%202-2-7-2l-11%201m27%2012c0%202%200%203%202%202l1%202c0%202-1%203-2%203v1c1%202%202%201%203-2%201-2%202-3%204-3s3%200%202%201v1h2l4-2c2-1%202-1%202%203-1%204%200%204%201%200%201-3%203-4%205-3l1-2c0-2-1-3-13-3h-12v2m38%203l-2%201h-1c-1-1-6-1-7%201v2c-2%203-1%203%205%203s6%200%209-3c2-3%203-2%200%202-2%204%200%204%203%200%203-3%205-4%203-1s-1%203%207%203c9%200%2015-3%2015-7%200-1-22-2-24-1h-8m12%2032v5l-3%205-1%203h6l4-2%204-1%203%201h4c0%201%203-1%203-3l-9-1-9%201v-3l-1-6c-1-2-1-2-1%201m88%2027l-1%201h-1l-2%202-2%203%202%201%202%201c1%201%202%202%203%201v-1l4-1c5-1%206%200%206%205l-2%202-4%201c-2%202-2%202%202%202%204-1%205-1%205-4s1-4%202-4l1-2c0-1-2-2-6-2l-4-1h4l7-2%203-1h2l-4-1c-7%201-12%203-13%204l-2%201c-1%200-2-1-1-3v-3l-1%201M37%20105c0%207%200%207%203%207%202%200%202%200%202%206v6h3c3%200%204-1%205-2l3-1c2%201%203%200%203-1h-1l-2-1c0-1%201-2%202-1l1-1-1-3-3-2c-4%200-5-2-2-3l-1-1-1-3v-5l-2-1-6-1h-3v7m47%208l-1%208v7h3c3%200%204-1%202-3-2-1-1-2%203-3%204%200%204%200%204%203%200%204%202%204%203%200%201-2%200-5-2-3l-1-3c1-3%201-4-1-4l-1%203-1%203c-2%200-5-2-5-4%201-3-2-7-3-4m-33%2019l1%208%201%207c0%207%200%207%203%207%202%200%202%200%201-1-2-1-2-1%201-2%204%200%204-2%201-2l-2-1h2c2%200%203-2%200-2l1-1v-1l-3-1h-1l3-1c3%200%207-2%205-2l-1-3c1-3%200-3-2-3-3%200-4-2-1-2%204-2%203-4-2-5l-6-1c-1-1-1%200-1%206m41%203c0%204-1%204-4%204-5%200-7%201-7%207%200%205%200%206%202%206l1-1h1c2%200%202%200%201-1l-1-1c3%200%202-3%200-3l-2-1%201-1v-1c-2-1%201-2%205-2%202%200%203%200%203%202%200%203%200%209%201%207l2-2v-2l-1-1v-2c-1-1-1-1%201-2l1-1c-1%200-2%200-1-1v-6c-1%200-1-1%201-1%201-1%201-1-1-1-3%200-3%200-3%204m211%2051v2c2%205%201%207-5%206l-1%201c-1%201-2%202-3%201l-3%201h14l3%201c2%200%203%200%202-3%200-2%200-2%201-1l3%201c2%200%202%200-1-2l-3-3%204%201c4%201%206%204%204%204s-2%200%200%203c2%204%203%204%203-2l1-5%203-1v-2l-2-2c0-1-1-2-11-2s-11%200-9%202m-179%2013l-6%202c-2%200-2%200%200%201%202%200%203%202%200%204v3c-3%202-4%201-3-1%202-3%201-3-1-2-1%201-3%202-4%201l-2%201-1%202-8%202c-2%200-2%200-1%202v1l1%201h4c0-2%202-2%204-1%202%200%204%200%207-2%205-3%209-2%208%201v1h2l-2%202c-2%200-2%202%201%202%202%200%204-6%203-9%200-2%200-2%204-2s8-4%208-7c0-2-2-3-2-1h-2l-3-1-2-1c1-3-1-2-5%201m169%209l-10%201c-5%200-6%201-6%202l1%206c0%203%200%204%201%203%201-2%201-2%201%201s2%207%203%207l1-6v-7h21v-3c0-3-1-3-4-3l-4-1h-4m-100%203l-1%204h23v-7l-1%201-2%201-10-2h-9v3m-50%2010l-4%204-1%202c-1%202-1%202-2%201h-3l-1%201c1%200%201%201-1%201-1%202-1%202%201%202s3%201%203%202l1%208c1%201%204-5%205-9%200-2%201-5%203-7l3-10-4%205m58-4c-3%200-3%200-3%205v4h7c6%200%206-1%206-3s1-3%203-1v1c-2%200-1%203%202%204%203%200%204-1%201-5l-1-3c1-1%200-3-1-2l-2%202-1%201v-2l-3-1h-8m-159%205l-7%204-1%201-5%203c-5%203-6%206-1%206l3-1%202-1c2%200%206-3%206-6l6-6c5-2%206-3%204-3l-7%203m127-1c-6%200-7%202-1%202%204%200%204%200%204%204%200%203%200%203%201%202%202-2%204-1%205%201%201%203%204%203%204%201l2-1%201-1%202-1c3%200%203%200%202-3s-5-5-8-2c-2%203-7%202-7%200s-1-2-5-2m92%207c-1%201%206%2014%207%2014s1-1-2-5c-2-3-2-4-1-5h9c1%201%202%200%203-1l1-2-3-1c-2-3-14-3-14%200'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":1.497584541062802,"src":"/static/e2542220cb75c780b1242e17f31664f7/77467/0_BQNcJ9ASkBDCLP27.jpg","srcSet":"/static/e2542220cb75c780b1242e17f31664f7/dece2/0_BQNcJ9ASkBDCLP27.jpg 310w,\n/static/e2542220cb75c780b1242e17f31664f7/fcb16/0_BQNcJ9ASkBDCLP27.jpg 620w,\n/static/e2542220cb75c780b1242e17f31664f7/77467/0_BQNcJ9ASkBDCLP27.jpg 1240w,\n/static/e2542220cb75c780b1242e17f31664f7/b1020/0_BQNcJ9ASkBDCLP27.jpg 1860w,\n/static/e2542220cb75c780b1242e17f31664f7/88564/0_BQNcJ9ASkBDCLP27.jpg 2480w,\n/static/e2542220cb75c780b1242e17f31664f7/de9c6/0_BQNcJ9ASkBDCLP27.jpg 4000w","sizes":"(max-width: 1240px) 100vw, 1240px"}}},"author":"Chor Hung Tsang","source":"https://unsplash.com/@chortsang","sourceText":"Unsplash","is_cover":1,"galleryId":0}]}}},"pageContext":{"id":"18584ed9-f311-5ad3-889c-6fd97f97a727"}}}